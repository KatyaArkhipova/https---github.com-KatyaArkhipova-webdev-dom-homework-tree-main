<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="comments-list">
        <li class="comment">
          <div class="comment-header">
            <div>Глеб Фокин</div>
            <div>12.02.22 12:18</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Это будет первый комментарий на этой странице
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">3</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>
        <li class="comment">
          <div class="comment-header">
            <div>Варвара Н.</div>
            <div>13.02.22 19:22</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Мне нравится как оформлена эта страница! ❤
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">75</span>
              <button class="like-button-active-like"></button>
            </div>
          </div>
        </li>
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="add-comment-button">Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
  
  
  document.addEventListener("DOMContentLoaded", function () {
    const commentsList = document.getElementById('comments-list');
    const addCommentButton = document.getElementById('add-comment-button');
    const nameInput = document.querySelector('.add-form-name');
    const commentInput = document.querySelector('.add-form-text');

    
    const comments = [
        {
            name: "Глеб Фокин",
            date: "12.02.22 12:18",
            text: "Это будет первый комментарий на этой странице",
            likes: 3,
            liked: false
        },
        {
            name: "Варвара Н.",
            date: "13.02.22 19:22",
            text: "Мне нравится как оформлена эта страница! ❤",
            likes: 75,
            liked: true
        }
    ];

    function renderComments() {
        commentsList.innerHTML = '';
        comments.forEach((comment, index) => {
            const li = document.createElement('li');
            li.className = 'comment';
            li.innerHTML = `
                <div class="comment-header">
                    <div>${comment.name}</div>
                    <div>${comment.date}</div>
                </div>
                <div class="comment-body">
                    <div class="comment-text">${comment.text}</div>
                </div>
                <div class="comment-footer">
                    <div class="likes">
                        <span class="likes-counter">${comment.likes}</span>
                        <button class="like-button ${comment.liked ? 'like-button-active-like' : ''}" data-index="${index}"></button>
                    </div>
                </div>
            `;
            commentsList.appendChild(li);
        });
    }

    function toggleLike(index) {
        const comment = comments[index];
        comment.liked = !comment.liked;
        comment.likes += comment.liked ? 1 : -1; 
        renderComments();
    }

    commentsList.addEventListener('click', (event) => {
        if (event.target.classList.contains('like-button')) {
            const index = event.target.dataset.index;
            toggleLike(index);
        } else if (event.target.closest('.comment')) {
            const comment = event.target.closest('.comment');
            const author = comment.querySelector('.comment-header div:first-child').innerText;
            const text = comment.querySelector('.comment-text').innerText;

            
            const escapedAuthor = escapeHtml(author);
            const escapedText = escapeHtml(text);

            
            nameInput.value = escapedAuthor;
            commentInput.value = `> ${escapedText} `;
            commentInput.focus();
        }
    });

    addCommentButton.addEventListener('click', function () {
        if (!nameInput.value || !commentInput.value) {
            alert('Пожалуйста, заполните все поля.');
            return;
        }

        const currentDate = new Date().toLocaleString();
        
        
        const newComment = {
            name: escapeHtml(nameInput.value),
            date: currentDate,
            text: escapeHtml(commentInput.value),
            likes: 0,
            liked: false
        };

        comments.push(newComment);
        renderComments();

        
        nameInput.value = '';
        commentInput.value = '';
    });

    
    function escapeHtml(unsafe) {
        return unsafe
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;");
    }

    renderComments();
});

  </script>
</html>
